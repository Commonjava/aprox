<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <script type="text/javascript">
    var repoTable;
    $(document).ready(function()
    {
      $("#save-repo").hide();
      
      var listUrl = renderAdminUrl( 'repository', 'list' );
      notice( 'loading-repos', "Loading " + listUrl );
      repoTable = $("#repo-panel .listing-table").dataTable({
        "bProcessing": true,
        "sAjaxSource": listUrl,
        "sAjaxDataProp": "items",
        "aoColumns": [
          {
            "sTitle": "Repository Name",
            "bSortable": true,
            "mDataProp": "name",
          },
          {
            "sTitle": "AProx URL",
            "bSortable": true,
            "bUseRendered":false,
            "fnRender": function(o,data){return renderAccessLink('repository', data);},
            "sClass": "url-cell",
            "mDataProp": "name",
          },
          {
            "sTitle": "Remote URL",
            "bSortable": true,
            "bUseRendered":false,
            "fnRender": function(o,data){return renderRemoteLink(data);},
            "sClass": "url-cell",
            "mDataProp": "url",
          },
          {
            "sTitle": "Timeout",
            "mDataProp": "timeout_seconds"
          },
        ],
      });
      
      clear_notice( 'loading-repos' );
      
    });
    
    $('#create-repo').click(function()
    {
      var name = $('#repo-name').val();
      var url = $('#repo-url').val();
      var timeout = $('#repo-timeout').val();
      
      var repo = {
        "name": name,
        "url": url,
        "timeout_seconds": timeout,
      };
      
      notice( 'repo-' + name + '-created', "Saving new repository: " + name );
      var url = renderAdminUrl( 'repository' );
      postJSON( url, repo, 'repo-' + name + '-created' );
      
      repoTable.fnAddData( repo );
    });
    </script>
  </head>
  <body>
    <div id="repo-panel" class="content-pane">
      <div class="content-pane-controls">
        <input type="button" name="save-repos" value="Save Changes" enabled="false" />
        <input type="button" name="reset-repos" value="Discard Changes" enabled="false" />
      </div>
      <div class="existing-listing">
        <table class="listing-table" border="1">
          <tr>
            <th>Repository Name</th>
            <th>Local URL</th>
            <th>Remote URL</th>
            <th>Extra Attributes</th>
            <th>Controls</th>
          </tr>
        </table>
      </div>
      <div class="new-item">
        <form target="#add-repo">
          <div class="form-line">
            Repository Name: <input type="text" id="repo-name" size="15" />
          </div>
          <div class="form-line">
            Remote URL: <input type="text" class="url-cell" id="repo-url" size="45" />
          </div>
          <div class="form-line">
            Timeout (seconds): <input type="text" id="repo-timeout" size="3" />
          </div>
          <div class="form-line form-controls">
            <input type="button" id="create-repo" value="Create" />
            <input type="button" id="save-repo" value="Create" />
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
