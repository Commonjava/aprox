<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <script type="text/javascript">
    var repoTable;
    
    $(document).ready(function()
    {
      var listUrl = renderAdminUrl( 'repository', 'list' );
      notice( 'loading-repos', "Loading " + listUrl );
      repoTable = $("#repo-panel .listing-table").dataTable({
        "bProcessing": true,
        "sAjaxSource": listUrl,
        "sAjaxDataProp": "items",
        "aoColumns": [
          {
            "sTitle": "Repository Name",
            "bSortable": true,
            "mDataProp": "name",
          },
          {
            "sTitle": "AProx URL",
            "bSortable": true,
            "bUseRendered":false,
            "fnRender": function(o,data){return renderAccessUrl('repository', data);},
            "sClass": "url-cell",
            "mDataProp": "name",
          },
          {
            "sTitle": "Remote URL",
            "bSortable": true,
            "bUseRendered":false,
            // "fnRender": function(o,data){return renderRemoteLink(data);},
            "sClass": "url-cell editable",
            "mDataProp": "url",
          },
          {
            "sTitle": "Timeout",
            "mDataProp": "timeout_seconds",
            "sClass": "editable",
          },
        ],
        "fnInitComplete": function(oSettings, json) {
          $('#repo-panel .listing-table td.editable').editable(function(value,settings){
            var aPos = repoTable.fnGetPosition( this );
            repoTable.fnUpdate( value, aPos[0], aPos[1] );
            
            var data = repoTable.fnGetData( aPos[0] );
            
            // correct for string value of timeout seconds...
            data.timeout_seconds = parseInt( data.timeout_seconds );
            var name = data.name;
            var url = renderAdminUrl( 'repository', name );
            notice( 'repo-' + name + '-saved', "Saving repository: " + JSON.stringify(data) + " to: " + url );
            postJSON( url, data, 'repo-' + name + '-saved' );
          },{
            submit: "Save",
            cancel: "Cancel",
            indicator: "Saving...",
            tooltip: "Click to edit...",
          });
        },
      });
      
      
      clear_notice( 'loading-repos' );
      
    });
    
    // $('#repo-panel .listing-table tbody tr').live('click', function(e){
    //   selectRow( this, '#repo-panel .listing-table' );
    // });
    
    $('#create-repo').click(function()
    {
      var name = $('#repo-name').val();
      var url = $('#repo-url').val();
      var timeout = $('#repo-timeout').val();
      
      var repo = {
        "name": name,
        "url": url,
        "timeout_seconds": timeout,
      };
      
      notice( 'repo-' + name + '-created', "Saving new repository: " + name );
      var url = renderAdminUrl( 'repository' );
      postJSON( url, repo, 'repo-' + name + '-created' );
      
      repoTable.fnAddData( repo );
    });
    </script>
  </head>
  <body>
    <div id="repo-panel" class="content-pane">
      <div class="content-pane-controls">
        <input type="button" name="save-repos" value="Save Changes" enabled="false" />
        <input type="button" name="reset-repos" value="Discard Changes" enabled="false" />
      </div>
      <div class="existing-listing">
        <table class="listing-table" border="1">
          <tr>
            <th>Repository Name</th>
            <th>Local URL</th>
            <th>Remote URL</th>
            <th>Extra Attributes</th>
            <th>Controls</th>
          </tr>
        </table>
      </div>
      <div class="edit-item">
        <form target="#add-repo">
          <div class="form-line">
            Repository Name: <input type="text" id="repo-name" size="15" />
          </div>
          <div class="form-line">
            Remote URL: <input type="text" class="url-cell" id="repo-url" size="45" />
          </div>
          <div class="form-line">
            Timeout (seconds): <input type="text" id="repo-timeout" size="3" />
          </div>
          <div class="form-line form-controls">
            <input type="button" id="create-repo" value="Create" />
            <input type="reset" value="Clear" />
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
