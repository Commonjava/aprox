<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
  <script type="text/javascript">
  var deployTable;
  
  $(document).ready(function()
  {
    $("#save-deploy").hide();
    
    var listUrl = renderAdminUrl( 'deploy', 'list' );
    notice( 'loading-deploys', "Loading " + listUrl );
    deployTable = $("#deploy-panel .listing-table").dataTable({
      "bProcessing": true,
      "sAjaxSource": listUrl,
      "sAjaxDataProp": "items",
      "aoColumns": [
        {
          "sTitle": "Name",
          "bSortable": true,
          "mDataProp": "name",
        },
        {
          "sTitle": "AProx URL",
          "bSortable": true,
          "bUseRendered":false,
          "fnRender": function(o,data){return renderAccessLink('deploy', data);},
          "sClass": "url-cell",
          "mDataProp": "name",
        },
      ],
      "fnInitComplete": function(oSettings, json) {
        $('#deploy-panel .listing-table td.editable').editable(function(value,settings){
          var aPos = deployTable.fnGetPosition( this );
          
          // correct for string value of timeout seconds...
          deployTable.fnUpdate( value, aPos[0], aPos[1] );
          
          var data = deployTable.fnGetData( aPos[0] );
          
          // correct for string value of timeout seconds...
          // data.timeout_seconds = parseInt( data.timeout_seconds );
          var name = data.name;
          var url = renderAdminUrl( 'deploy', name );
          notice( 'deploy-' + name + '-saved', "Saving deploy point: " + JSON.stringify(data) + " to: " + url );
          postJSON( url, data, 'deploy-' + name + '-saved' );
        },{
          submit: "Save",
          cancel: "Cancel",
          indicator: "Saving...",
          tooltip: "Click to edit...",
        });
      },
    });
    
    clear_notice( 'loading-deploys' );
  });
  
  $('#create-deploy').click(function()
  {
    var name = $('#deploy-name').val();
    var snaps = $('#deploy-allow-snapshots').val();
    var rels = $('#deploy-allow-releases').val();
    
    var deploy = {
      "name": name,
      "allow_snapshots": snaps,
      "allow_releases": rels,
    };
    
    notice( 'deploy-' + name + '-created', "Saving new deploy point: " + name );
    var url = renderAdminUrl( 'deploy' );
    postJSON( url, deploy, 'deploy-' + name + '-created' );
    
    deployTable.fnAddData(
      deploy
    );
  });
  </script>
</head>
  <body>
      <div id="deploy-panel" class="content-pane">
        <div class="content-pane-controls">
          <input type="button" name="save-deploys" value="Save Changes" enabled="false" />
          <input type="button" name="reset-deploys" value="Discard Changes" enabled="false" />
        </div>
        <div class="existing-listing">
          <table class="listing-table" border="1">
            <tr>
              <th>Deploy-Point Name</th>
              <th>Local URL</th>
              <th>Extra Attributes</th>
              <th>Controls</th>
            </tr>
            <tr>
              <td>deploy-1</td>
              <td>http://localhost:9080/aprox/api/1.0/deploy/deploy-1/</td>
              <td>[releases][snapshots]</td>
              <td>[del]</td>
            </tr>
            <tr>
              <td>deploy-2</td>
              <td>http://localhost:9080/aprox/api/1.0/deploy/deploy-2/</td>
              <td>[releases]</td>
              <td>[del]</td>
            </tr>
            <tr>
              <td>deploy-3</td>
              <td>http://localhost:9080/aprox/api/1.0/deploy/deploy-3/</td>
              <td>[snapshots]</td>
              <td>[del]</td>
            </tr>
          </table>
        </div>
        <div class="edit-item">
          <form target="#add-deploy">
            <div class="form-line">
              Deploy-Point Name: <input type="text" id="deploy-name" size="15" />
            </div>
            <div class="form-line">
              <input type="checkbox" id="deploy-allow-releases" /> Allow Releases
            </div>
            <div class="form-line">
              <input type="checkbox" id="deploy-allow-snapshots" /> Allow Snapshots
            </div>
            <div class="form-line form-controls">
              <input type="button" id="create-deploy" value="Create" />
              <input type="button" id="save-deploy" value="Save" />
            </div>
          </form>
        </div>
      </div>
  </body>
</html>
